(self["webpackChunkwebgis"]=self["webpackChunkwebgis"]||[]).push([[687],{7944:function(e,t,i){var r,n;i(63408),i(14590),i(30541),i(57658),
/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */
function(){var i=function(){var e={defaultNoDataValue:-34027999387901484e22,decode:function(a,s){s=s||{};var o=s.encodedMaskData||null===s.encodedMaskData,l=n(a,s.inputOffset||0,o),u=null!==s.noDataValue?s.noDataValue:e.defaultNoDataValue,c=t(l,s.pixelType||Float32Array,s.encodedMaskData,u,s.returnMask),h={width:l.width,height:l.height,pixelData:c.resultPixels,minValue:c.minValue,maxValue:l.pixels.maxValue,noDataValue:u};return c.resultMask&&(h.maskData=c.resultMask),s.returnEncodedMask&&l.mask&&(h.encodedMaskData=l.mask.bitset?l.mask.bitset:null),s.returnFileInfo&&(h.fileInfo=i(l),s.computeUsedBitDepths&&(h.fileInfo.bitDepths=r(l))),h}},t=function(e,t,i,r,n){var s,o,l,u=0,c=e.pixels.numBlocksX,h=e.pixels.numBlocksY,d=Math.floor(e.width/c),f=Math.floor(e.height/h),m=2*e.maxZError,g=Number.MAX_VALUE;i=i||(e.mask?e.mask.bitset:null),o=new t(e.width*e.height),n&&i&&(l=new Uint8Array(e.width*e.height));for(var _,p,y=new Float32Array(d*f),v=0;v<=h;v++){var w=v!==h?f:e.height%h;if(0!==w)for(var x=0;x<=c;x++){var b=x!==c?d:e.width%c;if(0!==b){var Z,k,D,I,P=v*e.width*f+x*d,T=e.width-b,A=e.pixels.blocks[u];if(A.encoding<2?(0===A.encoding?Z=A.rawData:(a(A.stuffedData,A.bitsPerPixel,A.numValidPixels,A.offset,m,y,e.pixels.maxValue),Z=y),k=0):D=2===A.encoding?0:A.offset,i)for(p=0;p<w;p++){for(7&P&&(I=i[P>>3],I<<=7&P),_=0;_<b;_++)7&P||(I=i[P>>3]),128&I?(l&&(l[P]=1),s=A.encoding<2?Z[k++]:D,g=g>s?s:g,o[P++]=s):(l&&(l[P]=0),o[P++]=r),I<<=1;P+=T}else if(A.encoding<2)for(p=0;p<w;p++){for(_=0;_<b;_++)s=Z[k++],g=g>s?s:g,o[P++]=s;P+=T}else for(g=g>D?D:g,p=0;p<w;p++){for(_=0;_<b;_++)o[P++]=D;P+=T}if(1===A.encoding&&k!==A.numValidPixels)throw"Block and Mask do not match";u++}}}return{resultPixels:o,resultMask:l,minValue:g}},i=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},r=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,i={},r=0;r<t;r++){var n=e.pixels.blocks[r];0===n.encoding?i.float32=!0:1===n.encoding?i[n.bitsPerPixel]=!0:i[0]=!0}return Object.keys(i)},n=function(e,t,i){var r={},n=new Uint8Array(e,t,10);if(r.fileIdentifierString=String.fromCharCode.apply(null,n),"CntZImage"!==r.fileIdentifierString.trim())throw"Unexpected file identifier string: "+r.fileIdentifierString;t+=10;var a=new DataView(e,t,24);if(r.fileVersion=a.getInt32(0,!0),r.imageType=a.getInt32(4,!0),r.height=a.getUint32(8,!0),r.width=a.getUint32(12,!0),r.maxZError=a.getFloat64(16,!0),t+=24,!i)if(a=new DataView(e,t,16),r.mask={},r.mask.numBlocksY=a.getUint32(0,!0),r.mask.numBlocksX=a.getUint32(4,!0),r.mask.numBytes=a.getUint32(8,!0),r.mask.maxValue=a.getFloat32(12,!0),t+=16,r.mask.numBytes>0){var s=new Uint8Array(Math.ceil(r.width*r.height/8));a=new DataView(e,t,r.mask.numBytes);var o=a.getInt16(0,!0),l=2,u=0;do{if(o>0)while(o--)s[u++]=a.getUint8(l++);else{var c=a.getUint8(l++);o=-o;while(o--)s[u++]=c}o=a.getInt16(l,!0),l+=2}while(l<r.mask.numBytes);if(-32768!==o||u<s.length)throw"Unexpected end of mask RLE encoding";r.mask.bitset=s,t+=r.mask.numBytes}else 0===(r.mask.numBytes|r.mask.numBlocksY|r.mask.maxValue)&&(r.mask.bitset=new Uint8Array(Math.ceil(r.width*r.height/8)));a=new DataView(e,t,16),r.pixels={},r.pixels.numBlocksY=a.getUint32(0,!0),r.pixels.numBlocksX=a.getUint32(4,!0),r.pixels.numBytes=a.getUint32(8,!0),r.pixels.maxValue=a.getFloat32(12,!0),t+=16;var h=r.pixels.numBlocksX,d=r.pixels.numBlocksY,f=h+(r.width%h>0?1:0),m=d+(r.height%d>0?1:0);r.pixels.blocks=new Array(f*m);for(var g=0,_=0;_<m;_++)for(var p=0;p<f;p++){var y=0,v=e.byteLength-t;a=new DataView(e,t,Math.min(10,v));var w={};r.pixels.blocks[g++]=w;var x=a.getUint8(0);if(y++,w.encoding=63&x,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==x&&2!==x){if(x>>=6,w.offsetType=x,2===x)w.offset=a.getInt8(1),y++;else if(1===x)w.offset=a.getInt16(1,!0),y+=2;else{if(0!==x)throw"Invalid block offset type";w.offset=a.getFloat32(1,!0),y+=4}if(1===w.encoding)if(x=a.getUint8(y),y++,w.bitsPerPixel=63&x,x>>=6,w.numValidPixelsType=x,2===x)w.numValidPixels=a.getUint8(y),y++;else if(1===x)w.numValidPixels=a.getUint16(y,!0),y+=2;else{if(0!==x)throw"Invalid valid pixel count type";w.numValidPixels=a.getUint32(y,!0),y+=4}}var b,Z;if(t+=y,3!==w.encoding)if(0===w.encoding){var k=(r.pixels.numBytes-1)/4;if(k!==Math.floor(k))throw"uncompressed block has invalid length";b=new ArrayBuffer(4*k),Z=new Uint8Array(b),Z.set(new Uint8Array(e,t,4*k));var D=new Float32Array(b);w.rawData=D,t+=4*k}else if(1===w.encoding){var I=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),P=Math.ceil(I/4);b=new ArrayBuffer(4*P),Z=new Uint8Array(b),Z.set(new Uint8Array(e,t,I)),w.stuffedData=new Uint32Array(b),t+=I}}else t++}return r.eofOffset=t,r},a=function(e,t,i,r,n,a,s){var o,l,u,c=(1<<t)-1,h=0,d=0,f=Math.ceil((s-r)/n),m=4*e.length-Math.ceil(t*i/8);for(e[e.length-1]<<=8*m,o=0;o<i;o++){if(0===d&&(u=e[h++],d=32),d>=t)l=u>>>d-t&c,d-=t;else{var g=t-d;l=(u&c)<<g&c,u=e[h++],d=32-g,l+=u>>>d}a[o]=l<f?r+l*n:s}return a};return e}(),a=function(){"use strict";var e={unstuff:function(e,t,i,r,n,a,s,o){var l,u,c,h,d,f=(1<<i)-1,m=0,g=0,_=4*e.length-Math.ceil(i*r/8);if(e[e.length-1]<<=8*_,n)for(l=0;l<r;l++)0===g&&(c=e[m++],g=32),g>=i?(u=c>>>g-i&f,g-=i):(h=i-g,u=(c&f)<<h&f,c=e[m++],g=32-h,u+=c>>>g),t[l]=n[u];else for(d=Math.ceil((o-a)/s),l=0;l<r;l++)0===g&&(c=e[m++],g=32),g>=i?(u=c>>>g-i&f,g-=i):(h=i-g,u=(c&f)<<h&f,c=e[m++],g=32-h,u+=c>>>g),t[l]=u<d?a+u*s:o},unstuffLUT:function(e,t,i,r,n,a){var s,o=(1<<t)-1,l=0,u=0,c=0,h=0,d=0,f=[],m=4*e.length-Math.ceil(t*i/8);e[e.length-1]<<=8*m;var g=Math.ceil((a-r)/n);for(u=0;u<i;u++)0===h&&(s=e[l++],h=32),h>=t?(d=s>>>h-t&o,h-=t):(c=t-h,d=(s&o)<<c&o,s=e[l++],h=32-c,d+=s>>>h),f[u]=d<g?r+d*n:a;return f.unshift(r),f},unstuff2:function(e,t,i,r,n,a,s,o){var l,u,c,h,d=(1<<i)-1,f=0,m=0,g=0;if(n)for(l=0;l<r;l++)0===m&&(c=e[f++],m=32,g=0),m>=i?(u=c>>>g&d,m-=i,g+=i):(h=i-m,u=c>>>g&d,c=e[f++],m=32-h,u|=(c&(1<<h)-1)<<i-h,g=h),t[l]=n[u];else{var _=Math.ceil((o-a)/s);for(l=0;l<r;l++)0===m&&(c=e[f++],m=32,g=0),m>=i?(u=c>>>g&d,m-=i,g+=i):(h=i-m,u=c>>>g&d,c=e[f++],m=32-h,u|=(c&(1<<h)-1)<<i-h,g=h),t[l]=u<_?a+u*s:o}return t},unstuffLUT2:function(e,t,i,r,n,a){var s,o=(1<<t)-1,l=0,u=0,c=0,h=0,d=0,f=0,m=[],g=Math.ceil((a-r)/n);for(u=0;u<i;u++)0===h&&(s=e[l++],h=32,f=0),h>=t?(d=s>>>f&o,h-=t,f+=t):(c=t-h,d=s>>>f&o,s=e[l++],h=32-c,d|=(s&(1<<c)-1)<<t-c,f=c),m[u]=d<g?r+d*n:a;return m.unshift(r),m},originalUnstuff:function(e,t,i,r){var n,a,s,o,l=(1<<i)-1,u=0,c=0,h=4*e.length-Math.ceil(i*r/8);for(e[e.length-1]<<=8*h,n=0;n<r;n++)0===c&&(s=e[u++],c=32),c>=i?(a=s>>>c-i&l,c-=i):(o=i-c,a=(s&l)<<o&l,s=e[u++],c=32-o,a+=s>>>c),t[n]=a;return t},originalUnstuff2:function(e,t,i,r){var n,a,s,o,l=(1<<i)-1,u=0,c=0,h=0;for(n=0;n<r;n++)0===c&&(s=e[u++],c=32,h=0),c>=i?(a=s>>>h&l,c-=i,h+=i):(o=i-c,a=s>>>h&l,s=e[u++],c=32-o,a|=(s&(1<<o)-1)<<i-o,h=o),t[n]=a;return t}},t={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){var t=65535,i=65535,r=e.length,n=Math.floor(r/2),a=0;while(n){var s=n>=359?359:n;n-=s;do{t+=e[a++]<<8,i+=t+=e[a++]}while(--s);t=(65535&t)+(t>>>16),i=(65535&i)+(i>>>16)}return 1&r&&(i+=t+=e[a]<<8),t=(65535&t)+(t>>>16),i=(65535&i)+(i>>>16),(i<<16|t)>>>0},readHeaderInfo:function(e,t){var i=t.ptr,r=new Uint8Array(e,i,6),n={};if(n.fileIdentifierString=String.fromCharCode.apply(null,r),0!==n.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+n.fileIdentifierString;i+=6;var a,s,o=new DataView(e,i,8),l=o.getInt32(0,!0);if(n.fileVersion=l,i+=4,l>=3&&(n.checksum=o.getUint32(4,!0),i+=4),o=new DataView(e,i,12),n.height=o.getUint32(0,!0),n.width=o.getUint32(4,!0),i+=8,l>=4?(n.numDims=o.getUint32(8,!0),i+=4):n.numDims=1,o=new DataView(e,i,40),n.numValidPixel=o.getUint32(0,!0),n.microBlockSize=o.getInt32(4,!0),n.blobSize=o.getInt32(8,!0),n.imageType=o.getInt32(12,!0),n.maxZError=o.getFloat64(16,!0),n.zMin=o.getFloat64(24,!0),n.zMax=o.getFloat64(32,!0),i+=40,t.headerInfo=n,t.ptr=i,l>=3&&(s=l>=4?52:48,a=this.computeChecksumFletcher32(new Uint8Array(e,i-s,n.blobSize-14)),a!==n.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var i=t.headerInfo,r=this.getDataTypeArray(i.imageType),n=i.numDims*this.getDataTypeSize(i.imageType),a=this.readSubArray(e,t.ptr,r,n),s=this.readSubArray(e,t.ptr+n,r,n);t.ptr+=2*n;var o,l=!0;for(o=0;o<i.numDims;o++)if(a[o]!==s[o]){l=!1;break}return i.minValues=a,i.maxValues=s,l},readSubArray:function(e,t,i,r){var n;if(i===Uint8Array)n=new Uint8Array(e,t,r);else{var a=new ArrayBuffer(r),s=new Uint8Array(a);s.set(new Uint8Array(e,t,r)),n=new i(a)}return n},readMask:function(e,t){var i,r,n=t.ptr,a=t.headerInfo,s=a.width*a.height,o=a.numValidPixel,l=new DataView(e,n,4),u={};if(u.numBytes=l.getUint32(0,!0),n+=4,(0===o||s===o)&&0!==u.numBytes)throw"invalid mask";if(0===o)i=new Uint8Array(Math.ceil(s/8)),u.bitset=i,r=new Uint8Array(s),t.pixels.resultMask=r,n+=u.numBytes;else if(u.numBytes>0){i=new Uint8Array(Math.ceil(s/8)),l=new DataView(e,n,u.numBytes);var c=l.getInt16(0,!0),h=2,d=0,f=0;do{if(c>0)while(c--)i[d++]=l.getUint8(h++);else{f=l.getUint8(h++),c=-c;while(c--)i[d++]=f}c=l.getInt16(h,!0),h+=2}while(h<u.numBytes);if(-32768!==c||d<i.length)throw"Unexpected end of mask RLE encoding";r=new Uint8Array(s);var m=0,g=0;for(g=0;g<s;g++)7&g?(m=i[g>>3],m<<=7&g):m=i[g>>3],128&m&&(r[g]=1);t.pixels.resultMask=r,u.bitset=i,n+=u.numBytes}return t.ptr=n,t.mask=u,!0},readDataOneSweep:function(e,i,r){var n,a=i.ptr,s=i.headerInfo,o=s.numDims,l=s.width*s.height,u=s.imageType,c=s.numValidPixel*t.getDataTypeSize(u)*o,h=i.pixels.resultMask;if(r===Uint8Array)n=new Uint8Array(e,a,c);else{var d=new ArrayBuffer(c),f=new Uint8Array(d);f.set(new Uint8Array(e,a,c)),n=new r(d)}if(n.length===l*o)i.pixels.resultPixels=n;else{i.pixels.resultPixels=new r(l*o);var m=0,g=0,_=0,p=0;if(o>1)for(_=0;_<o;_++)for(p=_*l,g=0;g<l;g++)h[g]&&(i.pixels.resultPixels[p+g]=n[m++]);else for(g=0;g<l;g++)h[g]&&(i.pixels.resultPixels[g]=n[m++])}return a+=c,i.ptr=a,!0},readHuffmanTree:function(e,r){var n=this.HUFFMAN_LUT_BITS_MAX,a=new DataView(e,r.ptr,16);r.ptr+=16;var s=a.getInt32(0,!0);if(s<2)throw"unsupported Huffman version";var o=a.getInt32(4,!0),l=a.getInt32(8,!0),u=a.getInt32(12,!0);if(l>=u)return!1;var c=new Uint32Array(u-l);t.decodeBits(e,r,c);var h,d,f,m,g=[];for(h=l;h<u;h++)d=h-(h<o?0:o),g[d]={first:c[h-l],second:null};var _=e.byteLength-r.ptr,p=Math.ceil(_/4),y=new ArrayBuffer(4*p),v=new Uint8Array(y);v.set(new Uint8Array(e,r.ptr,_));var w,x=new Uint32Array(y),b=0,Z=0;for(w=x[0],h=l;h<u;h++)d=h-(h<o?0:o),m=g[d].first,m>0&&(g[d].second=w<<b>>>32-m,32-b>=m?(b+=m,32===b&&(b=0,Z++,w=x[Z])):(b+=m-32,Z++,w=x[Z],g[d].second|=w>>>32-b));var k=0,D=0,I=new i;for(h=0;h<g.length;h++)void 0!==g[h]&&(k=Math.max(k,g[h].first));D=k>=n?n:k,k>=30&&console.log("WARning, large NUM LUT BITS IS "+k);var P,T,A,U,S,M,V=[];for(h=l;h<u;h++)if(d=h-(h<o?0:o),m=g[d].first,m>0)if(P=[m,d],m<=D)for(T=g[d].second<<D-m,A=1<<D-m,f=0;f<A;f++)V[T|f]=P;else for(T=g[d].second,M=I,U=m-1;U>=0;U--)S=T>>>U&1,S?(M.right||(M.right=new i),M=M.right):(M.left||(M.left=new i),M=M.left),0!==U||M.val||(M.val=P[1]);return{decodeLut:V,numBitsLUTQick:D,numBitsLUT:k,tree:I,stuffedData:x,srcPtr:Z,bitPos:b}},readHuffman:function(e,t,i){var r,n,a,s,o,l,u,c,h,d,f=t.headerInfo,m=f.numDims,g=t.headerInfo.height,_=t.headerInfo.width,p=_*g,y=this.readHuffmanTree(e,t),v=y.decodeLut,w=y.tree,x=y.stuffedData,b=y.srcPtr,Z=y.bitPos,k=y.numBitsLUTQick,D=y.numBitsLUT,I=0===t.headerInfo.imageType?128:0,P=t.pixels.resultMask,T=0;Z>0&&(b++,Z=0);var A,U=x[b],S=1===t.encodeMode,M=new i(p*m),V=M;for(A=0;A<f.numDims;A++){if(m>1&&(V=new i(M.buffer,p*A,p),T=0),t.headerInfo.numValidPixel===_*g)for(h=0,u=0;u<g;u++)for(c=0;c<_;c++,h++){if(n=0,s=U<<Z>>>32-k,o=s,32-Z<k&&(s|=x[b+1]>>>64-Z-k,o=s),v[o])n=v[o][1],Z+=v[o][0];else for(s=U<<Z>>>32-D,o=s,32-Z<D&&(s|=x[b+1]>>>64-Z-D,o=s),r=w,d=0;d<D;d++)if(l=s>>>D-d-1&1,r=l?r.right:r.left,!r.left&&!r.right){n=r.val,Z=Z+d+1;break}Z>=32&&(Z-=32,b++,U=x[b]),a=n-I,S?(a+=c>0?T:u>0?V[h-_]:T,a&=255,V[h]=a,T=a):V[h]=a}else for(h=0,u=0;u<g;u++)for(c=0;c<_;c++,h++)if(P[h]){if(n=0,s=U<<Z>>>32-k,o=s,32-Z<k&&(s|=x[b+1]>>>64-Z-k,o=s),v[o])n=v[o][1],Z+=v[o][0];else for(s=U<<Z>>>32-D,o=s,32-Z<D&&(s|=x[b+1]>>>64-Z-D,o=s),r=w,d=0;d<D;d++)if(l=s>>>D-d-1&1,r=l?r.right:r.left,!r.left&&!r.right){n=r.val,Z=Z+d+1;break}Z>=32&&(Z-=32,b++,U=x[b]),a=n-I,S?(c>0&&P[h-1]?a+=T:u>0&&P[h-_]?a+=V[h-_]:a+=T,a&=255,V[h]=a,T=a):V[h]=a}t.ptr=t.ptr+4*(b+1)+(Z>0?4:0)}t.pixels.resultPixels=M},decodeBits:function(t,i,r,n,a){var s=i.headerInfo,o=s.fileVersion,l=0,u=new DataView(t,i.ptr,5),c=u.getUint8(0);l++;var h=c>>6,d=0===h?4:3-h,f=(32&c)>0,m=31&c,g=0;if(1===d)g=u.getUint8(l),l++;else if(2===d)g=u.getUint16(l,!0),l+=2;else{if(4!==d)throw"Invalid valid pixel count type";g=u.getUint32(l,!0),l+=4}var _,p,y,v,w,x,b,Z,k,D=2*s.maxZError,I=s.numDims>1?s.maxValues[a]:s.zMax;if(f){i.counter.lut++,Z=u.getUint8(l),m,l++,v=Math.ceil((Z-1)*m/8),w=Math.ceil(v/4),p=new ArrayBuffer(4*w),y=new Uint8Array(p),i.ptr+=l,y.set(new Uint8Array(t,i.ptr,v)),b=new Uint32Array(p),i.ptr+=v,k=0;while(Z-1>>>k)k++;v=Math.ceil(g*k/8),w=Math.ceil(v/4),p=new ArrayBuffer(4*w),y=new Uint8Array(p),y.set(new Uint8Array(t,i.ptr,v)),_=new Uint32Array(p),i.ptr+=v,x=o>=3?e.unstuffLUT2(b,m,Z-1,n,D,I):e.unstuffLUT(b,m,Z-1,n,D,I),o>=3?e.unstuff2(_,r,k,g,x):e.unstuff(_,r,k,g,x)}else i.counter.bitstuffer++,k=m,i.ptr+=l,k>0&&(v=Math.ceil(g*k/8),w=Math.ceil(v/4),p=new ArrayBuffer(4*w),y=new Uint8Array(p),y.set(new Uint8Array(t,i.ptr,v)),_=new Uint32Array(p),i.ptr+=v,o>=3?null==n?e.originalUnstuff2(_,r,k,g):e.unstuff2(_,r,k,g,!1,n,D,I):null==n?e.originalUnstuff(_,r,k,g):e.unstuff(_,r,k,g,!1,n,D,I))},readTiles:function(e,i,r){var n=i.headerInfo,a=n.width,s=n.height,o=n.microBlockSize,l=n.imageType,u=t.getDataTypeSize(l),c=Math.ceil(a/o),h=Math.ceil(s/o);i.pixels.numBlocksY=h,i.pixels.numBlocksX=c,i.pixels.ptr=0;var d,f,m,g,_,p,y,v,w,x=0,b=0,Z=0,k=0,D=0,I=0,P=0,T=0,A=0,U=0,S=0,M=0,V=0,B=0,C=0,E=0,L=new r(o*o),R=s%o||o,F=a%o||o,O=n.numDims,N=i.pixels.resultMask,z=i.pixels.resultPixels;for(Z=0;Z<h;Z++)for(D=Z!==h-1?o:R,k=0;k<c;k++)for(I=k!==c-1?o:F,S=Z*a*o+k*o,M=a-I,w=0;w<O;w++){if(O>1&&(z=new r(i.pixels.resultPixels.buffer,a*s*w*u,a*s)),P=e.byteLength-i.ptr,d=new DataView(e,i.ptr,Math.min(10,P)),f={},E=0,T=d.getUint8(0),E++,A=T>>6&255,U=T>>2&15,U!==(k*o>>3&15))throw"integrity issue";if(p=3&T,p>3)throw i.ptr+=E,"Invalid block encoding ("+p+")";if(2!==p)if(0===p){if(i.counter.uncompressed++,i.ptr+=E,V=D*I*u,B=e.byteLength-i.ptr,V=V<B?V:B,m=new ArrayBuffer(V%u===0?V:V+u-V%u),g=new Uint8Array(m),g.set(new Uint8Array(e,i.ptr,V)),_=new r(m),C=0,N)for(x=0;x<D;x++){for(b=0;b<I;b++)N[S]&&(z[S]=_[C++]),S++;S+=M}else for(x=0;x<D;x++){for(b=0;b<I;b++)z[S++]=_[C++];S+=M}i.ptr+=C*u}else if(y=t.getDataTypeUsed(l,A),v=t.getOnePixel(f,E,y,d),E+=t.getDataTypeSize(y),3===p)if(i.ptr+=E,i.counter.constantoffset++,N)for(x=0;x<D;x++){for(b=0;b<I;b++)N[S]&&(z[S]=v),S++;S+=M}else for(x=0;x<D;x++){for(b=0;b<I;b++)z[S++]=v;S+=M}else if(i.ptr+=E,t.decodeBits(e,i,L,v,w),E=0,N)for(x=0;x<D;x++){for(b=0;b<I;b++)N[S]&&(z[S]=L[E++]),S++;S+=M}else for(x=0;x<D;x++){for(b=0;b<I;b++)z[S++]=L[E++];S+=M}else i.counter.constant++,i.ptr+=E}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:t.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var t=e.headerInfo.zMax,i=e.headerInfo.numDims,r=e.headerInfo.height*e.headerInfo.width,n=r*i,a=0,s=0,o=0,l=e.pixels.resultMask;if(l)if(i>1)for(a=0;a<i;a++)for(o=a*r,s=0;s<r;s++)l[s]&&(e.pixels.resultPixels[o+s]=t);else for(s=0;s<r;s++)l[s]&&(e.pixels.resultPixels[s]=t);else if(e.pixels.resultPixels.fill)e.pixels.resultPixels.fill(t);else for(s=0;s<n;s++)e.pixels.resultPixels[s]=t},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:t=Float32Array;break;case 7:t=Float64Array;break;default:t=Float32Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:t="F32";break;case 7:t="F64";break;default:t="F32"}return t},isValidPixelValue:function(e,t){if(null==t)return!1;var i;switch(e){case 0:i=t>=-128&&t<=127;break;case 1:i=t>=0&&t<=255;break;case 2:i=t>=-32768&&t<=32767;break;case 3:i=t>=0&&t<=65536;break;case 4:i=t>=-2147483648&&t<=2147483647;break;case 5:i=t>=0&&t<=4294967296;break;case 6:i=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:i=t>=5e-324&&t<=17976931348623157e292;break;default:i=!1}return i},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var i=e;switch(e){case 2:case 4:i=e-t;break;case 3:case 5:i=e-2*t;break;case 6:i=0===t?e:1===t?2:1;break;case 7:i=0===t?e:e-2*t+1;break;default:i=e;break}return i},getOnePixel:function(e,t,i,r){var n=0;switch(i){case 0:n=r.getInt8(t);break;case 1:n=r.getUint8(t);break;case 2:n=r.getInt16(t,!0);break;case 3:n=r.getUint16(t,!0);break;case 4:n=r.getInt32(t,!0);break;case 5:n=r.getUInt32(t,!0);break;case 6:n=r.getFloat32(t,!0);break;case 7:n=r.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return n}},i=function(e,t,i){this.val=e,this.left=t,this.right=i},r={decode:function(e,i){i=i||{};var r=i.noDataValue,n=0,a={};if(a.ptr=i.inputOffset||0,a.pixels={},t.readHeaderInfo(e,a)){var s=a.headerInfo,o=s.fileVersion,l=t.getDataTypeArray(s.imageType);t.readMask(e,a),s.numValidPixel===s.width*s.height||a.pixels.resultMask||(a.pixels.resultMask=i.maskData);var u,c=s.width*s.height;if(a.pixels.resultPixels=new l(c*s.numDims),a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==s.numValidPixel)if(s.zMax===s.zMin)t.constructConstantSurface(a);else if(o>=4&&t.checkMinMaxRanges(e,a))t.constructConstantSurface(a);else{var h=new DataView(e,a.ptr,2),d=h.getUint8(0);if(a.ptr++,d)t.readDataOneSweep(e,a,l);else if(o>1&&s.imageType<=1&&Math.abs(s.maxZError-.5)<1e-5){var f=h.getUint8(1);if(a.ptr++,a.encodeMode=f,f>2||o<4&&f>1)throw"Invalid Huffman flag "+f;f?t.readHuffman(e,a,l):t.readTiles(e,a,l)}else t.readTiles(e,a,l)}a.eofOffset=a.ptr,i.inputOffset?(u=a.headerInfo.blobSize+i.inputOffset-a.ptr,Math.abs(u)>=1&&(a.eofOffset=i.inputOffset+a.headerInfo.blobSize)):(u=a.headerInfo.blobSize-a.ptr,Math.abs(u)>=1&&(a.eofOffset=a.headerInfo.blobSize));var m={width:s.width,height:s.height,pixelData:a.pixels.resultPixels,minValue:s.zMin,maxValue:s.zMax,validPixelCount:s.numValidPixel,dimCount:s.numDims,dimStats:{minValues:s.minValues,maxValues:s.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&t.isValidPixelValue(s.imageType,r)){var g=a.pixels.resultMask;for(n=0;n<c;n++)g[n]||(m.pixelData[n]=r);m.noDataValue=r}return a.noDataValue=r,i.returnFileInfo&&(m.fileInfo=t.formatFileInfo(a)),m}},getBandCount:function(e){var i=0,r=0,n={ptr:0,pixels:{}};while(r<e.byteLength-58)t.readHeaderInfo(e,n),r+=n.headerInfo.blobSize,i++,n.ptr=r;return i}};return r}(),s=function(){var e=new ArrayBuffer(4),t=new Uint8Array(e),i=new Uint32Array(e);return i[0]=1,1===t[0]}(),o={decode:function(e,t){if(!s)throw"Big endian system is not supported.";t=t||{};var r,n,o=t.inputOffset||0,l=new Uint8Array(e,o,10),u=String.fromCharCode.apply(null,l);if("CntZImage"===u.trim())r=i,n=1;else{if("Lerc2"!==u.substring(0,5))throw"Unexpected file identifier string: "+u;r=a,n=2}var c,h,d,f,m,g,_=0,p=e.byteLength-10,y=[],v={width:0,height:0,pixels:[],pixelType:t.pixelType,mask:null,statistics:[]};while(o<p){var w=r.decode(e,{inputOffset:o,encodedMaskData:c,maskData:d,returnMask:0===_,returnEncodedMask:0===_,returnFileInfo:!0,pixelType:t.pixelType||null,noDataValue:t.noDataValue||null});o=w.fileInfo.eofOffset,0===_&&(c=w.encodedMaskData,d=w.maskData,v.width=w.width,v.height=w.height,v.dimCount=w.dimCount||1,v.pixelType=w.pixelType||w.fileInfo.pixelType,v.mask=w.maskData),n>1&&w.fileInfo.mask&&w.fileInfo.mask.numBytes>0&&y.push(w.maskData),_++,v.pixels.push(w.pixelData),v.statistics.push({minValue:w.minValue,maxValue:w.maxValue,noDataValue:w.noDataValue,dimStats:w.dimStats})}if(n>1&&y.length>1){for(g=v.width*v.height,v.bandMasks=y,d=new Uint8Array(g),d.set(y[0]),f=1;f<y.length;f++)for(h=y[f],m=0;m<g;m++)d[m]=d[m]&h[m];v.maskData=d}return v}};r=[],n=function(){return o}.apply(t,r),void 0===n||(e.exports=n)}()},66687:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Oe}});var r=i(73396);const n={id:"cesiumContainer"};function a(e,t,i,a,s,o){return(0,r.wg)(),(0,r.iD)("div",n)}var s=i(15863),o=i(48545),l=i(40985),u=(i(57658),i(42954)),c=i(71299),h=i(82830),d=i(49721),f=i(51625),m=i(62385),g=i(54013),_=i(58943),p=i(85914),y=i(32121),v=i(5360),w=i(4275),x=i(4222),b=i(49350),Z=i(23802),k=i(49810),D=i(14982),I=i(92775),P=i(55074),T=i(45262);const A=15;function U(e){this.ellipsoid=(0,d.Z)(e.ellipsoid,m.Z.WGS84),this.credit=void 0,this.tilingScheme=void 0,this.height=void 0,this.width=void 0,this.encoding=void 0,this.lodCount=void 0,this.hasAvailability=!1,this.tilesAvailable=void 0,this.tilesAvailabilityLoaded=void 0,this.levelZeroMaximumGeometricError=void 0,this.terrainDataStructure=void 0}function S(e,t){const i=t.copyrightText;(0,f.Z)(i)&&(e.credit=new h.Z(i));const r=t.spatialReference,n=(0,d.Z)(r.latestWkid,r.wkid),a=t.extent,s={ellipsoid:e.ellipsoid};if(4326===n)s.rectangle=v.Z.fromDegrees(a.xmin,a.ymin,a.xmax,a.ymax),e.tilingScheme=new _.Z(s);else{if(3857!==n)throw new k.Z("Invalid spatial reference");{const i=Math.PI*e.ellipsoid.maximumRadius;t.extent.xmax>i&&(t.extent.xmax=i),t.extent.ymax>i&&(t.extent.ymax=i),t.extent.xmin<-i&&(t.extent.xmin=-i),t.extent.ymin<-i&&(t.extent.ymin=-i),s.rectangleSouthwestInMeters=new u.Z(a.xmin,a.ymin),s.rectangleNortheastInMeters=new u.Z(a.xmax,a.ymax),e.tilingScheme=new T.Z(s)}}const o=t.tileInfo;if(!(0,f.Z)(o))throw new k.Z("tileInfo is required");e.width=o.rows+1,e.height=o.cols+1,e.encoding="LERC"===o.format?p.Z.LERC:p.Z.NONE,e.lodCount=o.lods.length-1;const l=e.hasAvailability=-1!==t.capabilities.indexOf("Tilemap");l&&(e.tilesAvailable=new I.Z(e.tilingScheme,e.lodCount),e.tilesAvailable.addAvailableTileRange(0,0,0,e.tilingScheme.getNumberOfXTilesAtLevel(0),e.tilingScheme.getNumberOfYTilesAtLevel(0)),e.tilesAvailabilityLoaded=new I.Z(e.tilingScheme,e.lodCount)),e.levelZeroMaximumGeometricError=D.Z.getEstimatedLevelZeroGeometricErrorForAHeightmap(e.tilingScheme.ellipsoid,e.width,e.tilingScheme.getNumberOfXTilesAtLevel(0)),t.bandCount>1&&console.log("ArcGISTiledElevationTerrainProvider: Terrain data has more than 1 band. Using the first one."),(0,f.Z)(t.minValues)&&(0,f.Z)(t.maxValues)?e.terrainDataStructure={elementMultiplier:1,lowestEncodedHeight:t.minValues[0],highestEncodedHeight:t.maxValues[0]}:e.terrainDataStructure={elementMultiplier:1}}async function M(e,t,i){try{const i=await t.fetchJson();S(e,i)}catch(r){const e=`An error occurred while accessing ${t}.`;throw P.Z.reportError(void 0,i,(0,f.Z)(i)?i._errorEvent:void 0,e),r}}function V(e){e=(0,d.Z)(e,d.Z.EMPTY_OBJECT),this._resource=void 0,this._credit=void 0,this._tilingScheme=void 0,this._levelZeroMaximumGeometricError=void 0,this._maxLevel=void 0,this._terrainDataStructure=void 0,this._width=void 0,this._height=void 0,this._encoding=void 0,this._lodCount=void 0,this._hasAvailability=!1,this._tilesAvailable=void 0,this._tilesAvailabilityLoaded=void 0,this._availableCache={},this._errorEvent=new g.Z}function B(e,t,i,r){if(!e._hasAvailability)return;const n=e._tilesAvailabilityLoaded,a=e._tilesAvailable;return!(t>e._lodCount)&&(!!a.isTileAvailable(t,i,r)||!n.isTileAvailable(t,i,r)&&void 0)}function C(e,t,i,r){const n=t-1,a=i-1,s=r[e.y*t+e.x],o=[],l={startX:e.x,startY:e.y,endX:0,endY:0},c=new u.Z(e.x+1,e.y+1);let h=!1,d=!1;while(!h||!d){let i=c.x;const f=d?c.y+1:c.y;if(!h){for(let i=e.y;i<f;++i)if(r[i*t+c.x]!==s){h=!0;break}h?(o.push(new u.Z(c.x,e.y)),--c.x,--i,l.endX=c.x):c.x===n?(l.endX=c.x,h=!0):++c.x}if(!d){const n=c.y*t;for(let t=e.x;t<=i;++t)if(r[n+t]!==s){d=!0;break}d?(o.push(new u.Z(e.x,c.y)),--c.y,l.endY=c.y):c.y===a?(l.endY=c.y,d=!0):++c.y}}return{endingIndices:o,range:l,value:s}}function E(e,t,i,r,n){const a=[],s=n.every((function(e){return e===n[0]}));if(s)return 1===n[0]&&a.push({startX:e,startY:t,endX:e+i-1,endY:t+r-1}),a;let o=[new u.Z(0,0)];while(o.length>0){const s=o.pop(),l=C(s,i,r,n);if(1===l.value){const i=l.range;i.startX+=e,i.endX+=e,i.startY+=t,i.endY+=t,a.push(i)}const u=l.endingIndices;u.length>0&&(o=o.concat(u))}return a}function L(e,t,i,r){if(!e._hasAvailability)return{};const n=128*Math.floor(i/128),a=128*Math.floor(r/128),s=Math.min(1<<t,128),o=`tilemap/${t}/${a}/${n}/${s}/${s}`,l=e._availableCache;if((0,f.Z)(l[o]))return l[o];const u=new w.Z({throttle:!1,throttleByServer:!0,type:b.Z.TERRAIN}),c=e._resource.getDerivedResource({url:o,request:u});let h=c.fetchJson();return(0,f.Z)(h)?(h=h.then((function(o){const l=E(n,a,s,s,o.data);e._tilesAvailabilityLoaded.addAvailableTileRange(t,n,a,n+s,a+s);const u=e._tilesAvailable;for(let e=0;e<l.length;++e){const i=l[e];u.addAvailableTileRange(t,i.startX,i.startY,i.endX,i.endY)}return B(e,t,i,r)})),l[o]={promise:h,request:u},h=h.finally((function(e){return delete l[o],e})),{promise:h,request:u}):{}}U.prototype.build=function(e){e._credit=this.credit,e._tilingScheme=this.tilingScheme,e._height=this.height,e._width=this.width,e._encoding=this.encoding,e._lodCount=this.lodCount,e._hasAvailability=this.hasAvailability,e._tilesAvailable=this.tilesAvailable,e._tilesAvailabilityLoaded=this.tilesAvailabilityLoaded,e._levelZeroMaximumGeometricError=this.levelZeroMaximumGeometricError,e._terrainDataStructure=this.terrainDataStructure},Object.defineProperties(V.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){return this._tilesAvailable}}}),V.fromUrl=async function(e,t){c.Z.defined("url",e),t=(0,d.Z)(t,d.Z.EMPTY_OBJECT),e=await Promise.resolve(e);let i=Z.Z.createIfNeeded(e);i.appendForwardSlash(),(0,f.Z)(t.token)&&(i=i.getDerivedResource({queryParameters:{token:t.token}}));const r=i.getDerivedResource({queryParameters:{f:"pjson"}}),n=new U(t);await M(n,r);const a=new V(t);return n.build(a),a._resource=i,a},V.prototype.requestTileGeometry=function(e,t,i,r){const n=this._resource.getDerivedResource({url:`tile/${i}/${t}/${e}`,request:r}),a=this._hasAvailability;let s,o=Promise.resolve(!0);if(a&&!(0,f.Z)(B(this,i+1,2*e,2*t))){const r=L(this,i+1,2*e,2*t);o=r.promise,s=r.request}const l=n.fetchArrayBuffer();if(!(0,f.Z)(l)||!(0,f.Z)(o))return;const u=this,c=this._tilesAvailable;return Promise.all([l,o]).then((function(r){return new y.Z({buffer:r[0],width:u._width,height:u._height,childTileMask:a?c.computeChildMaskForTile(i,e,t):A,structure:u._terrainDataStructure,encoding:u._encoding})})).catch((function(e){return(0,f.Z)(s)&&s.state===x.Z.CANCELLED?(r.cancel(),r.deferred.promise.finally((function(){return r.state=x.Z.CANCELLED,Promise.reject(e)}))):Promise.reject(e)}))},V.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},V.prototype.getTileDataAvailable=function(e,t,i){if(!this._hasAvailability)return;const r=B(this,i,e,t);if((0,f.Z)(r))return r;L(this,i,e,t)},V.prototype.loadTileDataAvailability=function(e,t,i){};var R=V,F=(i(63408),i(14590),i(30172)),O=i(88002),N=i(13968),z=i(24406),G=i(92067),X=i(547),Y=i(121),q=i(87389),$=i(67584),j=i(38878),J=i(70805),H=i(45402);function W(){}async function Q(){const e=await W._decodeTaskProcessor.initWebAssemblyModule({wasmBinaryFile:"ThirdParty/draco_decoder.wasm"});if(e)return W._decodeTaskProcessor;throw new k.Z("I3S decoder could not be initialized.")}W._maxDecodingConcurrency=Math.max(l.Z.hardwareConcurrency-1,1),W._decodeTaskProcessor=new H.Z("decodeI3S",W._maxDecodingConcurrency),W._promise=void 0,W.decode=async function(e,t,i,r){return c.Z.typeOf.string("url",e),c.Z.defined("defaultGeometrySchema",t),c.Z.defined("geometryData",i),(0,f.Z)(W._promise)||(W._promise=Q()),W._promise.then((function(n){const a=i._parent._data,s=i._parent._inverseRotationMatrix;let o=0,l=0,u=0;(0,f.Z)(a.obb)?(o=a.obb.center[0],l=a.obb.center[1],u=a.obb.center[2]):(0,f.Z)(a.mbs)&&(o=a.mbs[0],l=a.mbs[1],u=a.mbs[2]);const c=X.Z.fromRotationX(-J.Z.PI_OVER_TWO),h=new X.Z;X.Z.multiply(c,s,h);const d=F.Z.fromDegrees(o,l,u),g=m.Z.WGS84.cartographicToCartesian(d),_={binaryData:i._data,featureData:(0,f.Z)(r)&&(0,f.Z)(r[0])?r[0].data:void 0,schema:t,bufferInfo:i._geometryBufferInfo,ellipsoidRadiiSquare:m.Z.WGS84.radiiSquared,url:e,geoidDataList:i._dataProvider._geoidDataList,cartographicCenter:d,cartesianCenter:g,parentRotation:h};return n.scheduleTask(_)}))};var K=W;function ee(e,t){this._parent=e,this._dataProvider=e._dataProvider,this._layer=e._layer,(0,f.Z)(this._parent._nodeIndex)?this._resource=this._parent._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.attribute.resource}/${t}`}):this._resource=this._parent.resource.getDerivedResource({url:t})}Object.defineProperties(ee.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}}}),ee.prototype.load=async function(){return this._data=await Ee.loadJson(this._resource,this._dataProvider._traceFetches),this._data};var te=ee;function ie(e,t){this._storageInfo=t,this._parent=e,this._dataProvider=e._dataProvider;const i=`attributes/${t.key}/0`;(0,f.Z)(this._parent._nodeIndex)?this._resource=this._parent._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.attribute.resource}/${i}`}):this._resource=this._parent.resource.getDerivedResource({url:i})}function re(e){return"UInt8"===e||"Int8"===e?1:"UInt16"===e||"Int16"===e?2:"UInt32"===e||"Int32"===e||"Oid32"===e||"Float32"===e?4:"UInt64"===e||"Int64"===e||"Float64"===e?8:0}Object.defineProperties(ie.prototype,{resource:{get:function(){return this._resource}},header:{get:function(){return this._header}},values:{get:function(){return(0,f.Z)(this._values)&&(0,f.Z)(this._values.attributeValues)?this._values.attributeValues:[]}},name:{get:function(){return this._storageInfo.name}}}),ie.prototype.load=function(){const e=this;return this._dataProvider._loadBinary(this._resource).then((function(t){const i=new DataView(t);let r=!0;if(i.getUint8(0)==="{".charCodeAt(0)){const i=new TextDecoder,n=i.decode(t);n.includes("404")&&(r=!1,console.error(`Failed to load: ${e.resource.url}`))}if(r){e._data=t;let r=e._parseHeader(i);const n=re(e._storageInfo.attributeValues.valueType);n>0&&(r=Math.ceil(r/n)*n),e._parseBody(i,r)}}))},ie.prototype._parseValue=function(e,t,i){let r;if("UInt8"===t)r=e.getUint8(i),i+=1;else if("Int8"===t)r=e.getInt8(i),i+=1;else if("UInt16"===t)r=e.getUint16(i,!0),i+=2;else if("Int16"===t)r=e.getInt16(i,!0),i+=2;else if("UInt32"===t)r=e.getUint32(i,!0),i+=4;else if("Oid32"===t)r=e.getUint32(i,!0),i+=4;else if("Int32"===t)r=e.getInt32(i,!0),i+=4;else if("UInt64"===t){const t=e.getUint32(i,!0),n=e.getUint32(i+4,!0);r=t+Math.pow(2,32)*n,i+=8}else if("Int64"===t){const t=e.getUint32(i,!0),n=e.getUint32(i+4,!0);r=n<Math.pow(2,31)?t+Math.pow(2,32)*n:t+Math.pow(2,32)*(n-Math.pow(2,32)),i+=8}else"Float32"===t?(r=e.getFloat32(i,!0),i+=4):"Float64"===t?(r=e.getFloat64(i,!0),i+=8):"String"===t&&(r=String.fromCharCode(e.getUint8(i)),i+=1);return{value:r,offset:i}},ie.prototype._parseHeader=function(e){let t=0;this._header={};for(let i=0;i<this._storageInfo.header.length;i++){const r=this._storageInfo.header[i],n=this._parseValue(e,r.valueType,t);this._header[r.property]=n.value,t=n.offset}return t},ie.prototype._parseBody=function(e,t){this._values={};for(let i=0;i<this._storageInfo.ordering.length;i++){const r=this._storageInfo.ordering[i],n=this._storageInfo[r];if((0,f.Z)(n)){this._values[r]=[];for(let i=0;i<this._header.count;++i)if("String"!==n.valueType){const i=this._parseValue(e,n.valueType,t);this._values[r].push(i.value),t=i.offset}else{const a=this._values.attributeByteCounts[i];let s="";for(let i=0;i<a;++i){const i=this._parseValue(e,n.valueType,t);0!==i.value.charCodeAt(0)&&(s+=i.value),t=i.offset}this._values[r].push(s)}}}};var ne=ie,ae=i(40617);function se(e,t){const i=e._dataProvider,r=e._layer;let n;n=(0,f.Z)(e._nodeIndex)?r.resource.getDerivedResource({url:`nodes/${e._data.mesh.geometry.resource}/${t}`}):e.resource.getDerivedResource({url:t}),this._parent=e,this._dataProvider=i,this._layer=r,this._resource=n,this._customAttributes=void 0}Object.defineProperties(se.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}},customAttributes:{get:function(){return this._customAttributes}}}),se.prototype.load=function(){const e=this;return this._dataProvider._loadBinary(this._resource).then((function(t){return e._data=t,t}))};const oe=new ae.Z,le=new ae.Z,ue=new ae.Z,ce=new ae.Z,he=new ae.Z;function de(e,t,i,r){const n=ae.Z.subtract(r,i,oe),a=ae.Z.cross(n,ae.Z.subtract(e,i,le),ce),s=ae.Z.cross(n,ae.Z.subtract(t,i,ue),he);return ae.Z.dot(a,s)>=0}const fe=new ae.Z,me=new ae.Z,ge=new ae.Z,_e=new ae.Z,pe=new ae.Z,ye=new ae.Z,ve=new ae.Z,we=new ae.Z,xe=new ae.Z,be=new ae.Z;se.prototype.getClosestPointIndexOnTriangle=function(e,t,i){if((0,f.Z)(this._customAttributes)&&(0,f.Z)(this._customAttributes.positions)){const r=new ae.Z(e,t,i);r.x-=this._customAttributes.cartesianCenter.x,r.y-=this._customAttributes.cartesianCenter.y,r.z-=this._customAttributes.cartesianCenter.z,X.Z.multiplyByVector(this._customAttributes.parentRotation,r,r);let n,a,s,o,l=Number.MAX_VALUE;const u=this._customAttributes.positions,c=this._customAttributes.indices;let h;h=(0,f.Z)(c)?c.length:u.length/3;for(let e=0;e<h;e++){let t,i,h;(0,f.Z)(c)?(t=c[e],i=c[e+1],h=c[e+2]):(t=3*e,i=3*e+1,h=3*e+2);const d=ae.Z.fromElements(u[3*t],u[3*t+1],u[3*t+2],fe),m=ae.Z.fromElements(u[3*i],u[3*i+1],u[3*i+2],me),g=new ae.Z(u[3*h],u[3*h+1],u[3*h+2],ge);if(!de(r,d,m,g)||!de(r,m,d,g)||!de(r,g,d,m))continue;const _=ae.Z.subtract(m,d,_e),p=ae.Z.subtract(g,d,pe),y=ae.Z.cross(_,p,ye);if(0===ae.Z.magnitude(y))continue;const v=ae.Z.normalize(y,ve),w=ae.Z.subtract(r,d,we),x=Math.abs(ae.Z.dot(w,v));if(x<l){l=x,n=e;const u=ae.Z.magnitudeSquared(ae.Z.subtract(r,d,w)),c=ae.Z.magnitudeSquared(ae.Z.subtract(r,m,xe)),f=ae.Z.magnitudeSquared(ae.Z.subtract(r,g,be));u<c&&u<f?(s=t,o=d,a=u):c<f?(s=i,o=m,a=c):(s=h,o=g,a=f)}}if((0,f.Z)(n))return{index:s,distanceSquared:a,distance:Math.sqrt(a),queriedPosition:r,closestPosition:ae.Z.clone(o)}}return{index:-1,distanceSquared:Number.Infinity,distance:Number.Infinity}},se.prototype._generateGltf=function(e,t,i,r,n,a){let s,o={pbrMetallicRoughness:{metallicFactor:0},doubleSided:!0,name:"Material"},l=!1,u="";if((0,f.Z)(this._parent._data.mesh)&&(0,f.Z)(this._layer._data.materialDefinitions)){const e=this._parent._data.mesh.material,t=e.definition;if(t>=0&&t<this._layer._data.materialDefinitions.length&&(s=this._layer._data.materialDefinitions[t],o=s,(0,f.Z)(o.pbrMetallicRoughness)&&(0,f.Z)(o.pbrMetallicRoughness.baseColorTexture))){l=!0,o.pbrMetallicRoughness.baseColorTexture.index=0;let e="0";if((0,f.Z)(this._layer._data.textureSetDefinitions))for(let t=0;t<this._layer._data.textureSetDefinitions.length;t++){const i=this._layer._data.textureSetDefinitions[t];for(let t=0;t<i.formats.length;t++){const r=i.formats[t];if("jpg"===r.format){e=r.name;break}}}(0,f.Z)(this._parent._data.mesh)&&this._parent._data.mesh.material.resource>=0&&(u=this._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.material.resource}/textures/${e}`}).url)}}else(0,f.Z)(this._parent._data.textureData)&&(l=!0,u=this._parent.resource.getDerivedResource({url:`${this._parent._data.textureData[0].href}`}).url,o.pbrMetallicRoughness.baseColorTexture={index:0});let c=[],h=[],d=[];l&&(c=[{sampler:0,source:0}],h=[{uri:u}],d=[{magFilter:9729,minFilter:9986,wrapS:10497,wrapT:10497}]);const m={scene:0,scenes:[{nodes:e}],nodes:t,meshes:i,buffers:r,bufferViews:n,accessors:a,materials:[o],textures:c,images:h,samplers:d,asset:{version:"2.0"}};return m};var Ze=se;function ke(e,t,i){let r,n,a,s;i?(r=0,n=e):(r=e._level+1,n=e._layer),"number"===typeof t?a=t:s=e.resource.getDerivedResource({url:`${t}/`}),this._parent=e,this._dataProvider=e._dataProvider,this._isRoot=i,this._level=r,this._layer=n,this._nodeIndex=a,this._resource=s,this._isLoading=!1,this._tile=void 0,this._data=void 0,this._geometryData=[],this._featureData=[],this._fields={},this._children=[],this._childrenReadyPromise=void 0,this._globalTransform=void 0,this._inverseGlobalTransform=void 0,this._inverseRotationMatrix=void 0}function De(e,t,i,r,n,a){const s=i*(1-e)+r*e,o=n*(1-e)+a*e;return s*(1-t)+o*t}function Ie(e,t,i,r){const n=e+t*i;return r[n]}function Pe(e,t,i){const r=i.nativeExtent;let n=(e-r.west)/(r.east-r.west)*(i.width-1),a=(t-r.south)/(r.north-r.south)*(i.height-1);const s=Math.floor(n);let o=Math.floor(a);n-=s,a-=o;const l=s<i.width?s+1:s;let u=o<i.height?o+1:o;o=i.height-1-o,u=i.height-1-u;const c=Ie(s,o,i.width,i.buffer),h=Ie(l,o,i.width,i.buffer),d=Ie(s,u,i.width,i.buffer),f=Ie(l,u,i.width,i.buffer);let m=De(n,a,c,h,d,f);return m=m*i.scale+i.offset,m}Object.defineProperties(ke.prototype,{resource:{get:function(){return this._resource}},layer:{get:function(){return this._layer}},parent:{get:function(){return this._parent}},children:{get:function(){return this._children}},geometryData:{get:function(){return this._geometryData}},featureData:{get:function(){return this._featureData}},fields:{get:function(){return this._fields}},tile:{get:function(){return this._tile}},data:{get:function(){return this._data}}}),ke.prototype.load=async function(){const e=this;function t(){if(!e._isRoot){const t=e._create3DTileDefinition();e._tile=new j.Z(e._layer._tileset,e._dataProvider.resource,t,e._parent._tile),e._tile._i3sNode=e}}if(!(0,f.Z)(this._nodeIndex)){const i=await Ee.loadJson(this._resource,this._dataProvider._traceFetches);return e._data=i,void t()}const i=await this._layer._getNodeInNodePages(this._nodeIndex);let r;if(e._data=i,e._isRoot)r="nodes/root/";else if((0,f.Z)(i.mesh)){const e=i.mesh.geometry.resource;r=`../${e}/`}(0,f.Z)(r)&&(e._resource=e._parent.resource.getDerivedResource({url:r})),t()},ke.prototype.loadFields=function(){const e=this._layer._data.attributeStorageInfo,t=this;function i(e,i){const r=new ne(t,e[i]);return t._fields[r._storageInfo.name]=r,r.load()}const r=[];if((0,f.Z)(e))for(let n=0;n<e.length;n++)r.push(i(e,n));return Promise.all(r)},ke.prototype.getFieldsForPickedPosition=function(e){const t=this.geometryData[0];if(!(0,f.Z)(t.customAttributes.featureIndex))return{};const i=t.getClosestPointIndexOnTriangle(e.x,e.y,e.z);if(-1===i.index||i.index>t.customAttributes.featureIndex.length)return{};const r=t.customAttributes.featureIndex[i.index];return this.getFieldsForFeature(r)},ke.prototype.getFieldsForFeature=function(e){const t={};for(const i in this.fields)if(this.fields.hasOwnProperty(i)){const r=this.fields[i];e>=0&&e<r.values.length&&(t[r.name]=r.values[e])}return t},ke.prototype._loadChildren=function(){const e=this;if((0,f.Z)(this._childrenReadyPromise))return this._childrenReadyPromise;const t=[];if((0,f.Z)(e._data.children))for(let i=0;i<e._data.children.length;i++){const r=e._data.children[i],n=new ke(e,(0,d.Z)(r.href,r),!1);e._children.push(n),t.push(n.load())}return this._childrenReadyPromise=Promise.all(t).then((function(){for(let t=0;t<e._children.length;t++)e._tile.children.push(e._children[t]._tile)})),this._childrenReadyPromise},ke.prototype._loadGeometryData=function(){const e=[];if((0,f.Z)(this._data.geometryData))for(let t=0;t<this._data.geometryData.length;t++){const i=new Ze(this,this._data.geometryData[t].href);this._geometryData.push(i),e.push(i.load())}else if((0,f.Z)(this._data.mesh)){const t=this._layer._findBestGeometryBuffers(this._data.mesh.geometry.definition,["position","uv0"]),i=`./geometries/${t.bufferIndex}/`,r=new Ze(this,i);r._geometryDefinitions=t.definition,r._geometryBufferInfo=t.geometryBufferInfo,this._geometryData.push(r),e.push(r.load())}return Promise.all(e)},ke.prototype._loadFeatureData=function(){const e=[];if((0,f.Z)(this._data.featureData))for(let t=0;t<this._data.featureData.length;t++){const i=new te(this,this._data.featureData[t].href);this._featureData.push(i),e.push(i.load())}return Promise.all(e)},ke.prototype._clearGeometryData=function(){this._geometryData=[]},ke.prototype._create3DTileDefinition=function(){const e=this._data.obb,t=this._data.mbs;if(!(0,f.Z)(e)&&!(0,f.Z)(t))return void console.error("Failed to load I3S node. Bounding volume is required.");let i;if(i=(0,f.Z)(e)?F.Z.fromDegrees(e.center[0],e.center[1],e.center[2]):F.Z.fromDegrees(t[0],t[1],t[2]),(0,f.Z)(this._dataProvider._geoidDataList)&&(0,f.Z)(i))for(let f=0;f<this._dataProvider._geoidDataList.length;f++){const e=this._dataProvider._geoidDataList[f],t=e.projection.project(i);if(t.x>e.nativeExtent.west&&t.x<e.nativeExtent.east&&t.y>e.nativeExtent.south&&t.y<e.nativeExtent.north){i.height+=Pe(t.x,t.y,e);break}}let r,n={},a=0;(0,f.Z)(e)?(n={box:[0,0,0,e.halfSize[0],0,0,0,e.halfSize[1],0,0,0,e.halfSize[2]]},a=Math.max(Math.max(this._data.obb.halfSize[0],this._data.obb.halfSize[1]),this._data.obb.halfSize[2]),r=m.Z.WGS84.cartographicToCartesian(i)):(n={sphere:[0,0,0,t[3]]},r=m.Z.WGS84.cartographicToCartesian(i),a=this._data.mbs[3]),a*=2;let s=1/0;if((0,f.Z)(this._data.lodThreshold))if("maxScreenThresholdSQ"===this._layer._data.nodePages.lodSelectionMetricType){const e=Math.sqrt(this._data.lodThreshold/(.25*Math.PI));s=a/e}else if("maxScreenThreshold"===this._layer._data.nodePages.lodSelectionMetricType){const e=this._data.lodThreshold;s=a/e}else console.error("Invalid lodSelectionMetricType in Layer");else if((0,f.Z)(this._data.lodSelection))for(let f=0;f<this._data.lodSelection.length;f++)"maxScreenThreshold"===this._data.lodSelection[f].metricType&&(s=a/this._data.lodSelection[f].maxError);s===1/0&&(s=1e5);const o=16*s,l=new G.Z(0,0,0);let u=$.Z.headingPitchRollQuaternion(r,l);(0,f.Z)(this._data.obb)&&(u=new q.Z(this._data.obb.quaternion[0],this._data.obb.quaternion[1],this._data.obb.quaternion[2],this._data.obb.quaternion[3]));const c=X.Z.fromQuaternion(u),h=X.Z.inverse(c,new X.Z),d=new Y.Z(c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,r.x,r.y,r.z,1),g=Y.Z.inverse(d,new Y.Z),_=Y.Z.clone(d);(0,f.Z)(this._parent._globalTransform)&&Y.Z.multiply(d,this._parent._inverseGlobalTransform,_),this._globalTransform=d,this._inverseGlobalTransform=g,this._inverseRotationMatrix=h;const p=[];for(let f=0;f<this._children.length;f++)p.push(this._children[f]._create3DTileDefinition());const y={children:p,refine:"REPLACE",boundingVolume:n,transform:[_[0],_[4],_[8],_[12],_[1],_[5],_[9],_[13],_[2],_[6],_[10],_[14],_[3],_[7],_[11],_[15]],content:{uri:(0,f.Z)(this._resource)?this._resource.url:void 0},geometricError:o};return y},ke.prototype._createContentURL=async function(){let e={scene:0,scenes:[{nodes:[0]}],nodes:[{name:"singleNode"}],meshes:[],buffers:[],bufferViews:[],accessors:[],materials:[],textures:[],images:[],samplers:[],asset:{version:"2.0"}};const t=[this._loadGeometryData()];if(this._dataProvider.legacyVersion16&&t.push(this._loadFeatureData()),await Promise.all(t),(0,f.Z)(this._geometryData)&&this._geometryData.length>0){const t=this._geometryData[0].resource.url,i=this._layer._data.store.defaultGeometrySchema,r=this._geometryData[0],n=await K.decode(t,i,r,this._featureData[0]);if(!(0,f.Z)(n))return;e=r._generateGltf(n.meshData.nodesInScene,n.meshData.nodes,n.meshData.meshes,n.meshData.buffers,n.meshData.bufferViews,n.meshData.accessors),this._geometryData[0]._customAttributes=n.meshData._customAttributes}const i=this._dataProvider._binarizeGltf(e),r=new Blob([i],{type:"application/binary"});return URL.createObjectURL(r)},j.Z.prototype._hookedRequestContent=j.Z.prototype.requestContent,j.Z.prototype.requestContent=function(){return this.tileset._isI3STileSet?this._isLoading?void 0:(this._isLoading=!0,this._i3sNode._createContentURL().then((e=>{if((0,f.Z)(e))return this._contentResource=new Z.Z({url:e}),this._hookedRequestContent();this._isLoading=!1})).then((e=>(this._isLoading=!1,e)))):this._hookedRequestContent()},Object.defineProperties(j.Z.prototype,{i3sNode:{get:function(){return this._i3sNode}}});var Te=ke;function Ae(e,t,i){this._dataProvider=e,!(0,f.Z)(t.href)&&(0,f.Z)(i)&&(t.href=`layers/${i}`);const r=this._dataProvider.resource.getUrlComponent();let n="";n=r.match(/layers\/\d/)?`${r}`.replace(/\/+$/,""):`${r}`.replace(/\/?$/,"/").concat(`${t.href}`),this._version=t.store.version;const a=this._version.split(".");this._majorVersion=parseInt(a[0]),this._minorVersion=a.length>1?parseInt(a[1]):0,this._resource=new Z.Z({url:n}),this._resource.setQueryParameters(this._dataProvider.resource.queryParameters),this._resource.appendForwardSlash(),this._data=t,this._rootNode=void 0,this._nodePages={},this._nodePageFetches={},this._extent=void 0,this._tileset=void 0,this._geometryDefinitions=void 0,this._computeGeometryDefinitions(!0),this._computeExtent()}Object.defineProperties(Ae.prototype,{resource:{get:function(){return this._resource}},rootNode:{get:function(){return this._rootNode}},tileset:{get:function(){return this._tileset}},data:{get:function(){return this._data}},version:{get:function(){return this._version}},majorVersion:{get:function(){return this._majorVersion}},minorVersion:{get:function(){return this._minorVersion}},legacyVersion16:{get:function(){if((0,f.Z)(this.version))return this.majorVersion<1||1===this.majorVersion&&this.minorVersion<=6}}}),Ae.prototype.load=async function(e){if(4326!==this._data.spatialReference.wkid)throw new k.Z(`Unsupported spatial reference: ${this._data.spatialReference.wkid}`);if(await this._dataProvider.loadGeoidData(),await this._loadRootNode(e),await this._create3DTileset(e),this._rootNode._tile=this._tileset._root,this._tileset._root._i3sNode=this._rootNode,this.legacyVersion16)return this._rootNode._loadChildren()},Ae.prototype._computeGeometryDefinitions=function(e){if(this._geometryDefinitions=[],(0,f.Z)(this._data.geometryDefinitions))for(let t=0;t<this._data.geometryDefinitions.length;t++){const i=[],r=this._data.geometryDefinitions[t].geometryBuffers;for(let t=0;t<r.length;t++){const n=r[t],a=[];let s=!1;if((0,f.Z)(n.compressedAttributes)&&e){s=!0;const e=n.compressedAttributes.attributes;for(let t=0;t<e.length;t++)a.push(e[t])}else for(const e in n)"offset"!==e&&a.push(e);i.push({compressed:s,attributes:a,index:r.indexOf(n)})}i.sort((function(e,t){return e.compressed&&!t.compressed?-1:!e.compressed&&t.compressed?1:e.attributes.length-t.attributes.length})),this._geometryDefinitions.push(i)}},Ae.prototype._findBestGeometryBuffers=function(e,t){const i=this._geometryDefinitions[e];if((0,f.Z)(i))for(let r=0;r<i.length;++r){const e=i[r];let n=!1;const a=e.attributes;for(let i=0;i<t.length;i++)if(!a.includes(t[i])){n=!0;break}if(!n)return{bufferIndex:e.index,definition:i,geometryBufferInfo:e}}return 0},Ae.prototype._loadRootNode=function(e){if((0,f.Z)(this._data.nodePages)){let e=0;(0,f.Z)(this._data.nodePages.rootIndex)&&(e=this._data.nodePages.rootIndex),this._rootNode=new Te(this,e,!0)}else this._rootNode=new Te(this,this._data.store.rootNode,!0);return this._rootNode.load(e)},Ae.prototype._getNodeInNodePages=function(e){const t=Math.floor(e/this._data.nodePages.nodesPerPage),i=e%this._data.nodePages.nodesPerPage;return this._loadNodePage(t).then((function(e){return e.nodes[i]}))},Ae._fetchJson=function(e){return e.fetchJson()},Ae.prototype._loadNodePage=function(e){const t=this;if(!(0,f.Z)(this._nodePageFetches[e])){const i=this.resource.getDerivedResource({url:`nodepages/${e}/`}),r=Ae._fetchJson(i).then((function(i){return(0,f.Z)(i.error)&&200!==i.error.code?Promise.reject(i.error):(t._nodePages[e]=i.nodes,i)}));this._nodePageFetches[e]=r}return this._nodePageFetches[e]},Ae.prototype._computeExtent=function(){(0,f.Z)(this._data.fullExtent)?this._extent=v.Z.fromDegrees(this._data.fullExtent.xmin,this._data.fullExtent.ymin,this._data.fullExtent.xmax,this._data.fullExtent.ymax):(0,f.Z)(this._data.store.extent)&&(this._extent=v.Z.fromDegrees(this._data.store.extent[0],this._data.store.extent[1],this._data.store.extent[2],this._data.store.extent[3]))},Ae.prototype._create3DTileset=async function(e){const t={asset:{version:"1.0"},geometricError:Number.MAX_VALUE,root:this._rootNode._create3DTileDefinition()},i=new Blob([JSON.stringify(t)],{type:"application/json"}),r=URL.createObjectURL(i);this._tileset=await z.Z.fromUrl(r,e),this._tileset.show=this._dataProvider.show,this._tileset._isI3STileSet=!0,this._tileset.tileUnload.addEventListener((function(e){e._i3sNode._clearGeometryData(),URL.revokeObjectURL(e._contentResource._url),e._contentResource=e._i3sNode.resource})),this._tileset.tileVisible.addEventListener((function(e){(0,f.Z)(e._i3sNode)&&e._i3sNode._loadChildren()}))};var Ue=Ae,Se=i(7944);function Me(e){e=(0,d.Z)(e,d.Z.EMPTY_OBJECT),this._name=e.name,this._show=(0,d.Z)(e.show,!0),this._geoidTiledTerrainProvider=e.geoidTiledTerrainProvider,this._traceFetches=(0,d.Z)(e.traceFetches,!1),this._cesium3dTilesetOptions=(0,d.Z)(e.cesium3dTilesetOptions,d.Z.EMPTY_OBJECT),this._layers=[],this._data=void 0,this._extent=void 0,this._geoidDataPromise=void 0,this._geoidDataList=void 0,this._decoderTaskProcessor=void 0,this._taskProcessorReadyPromise=void 0}Object.defineProperties(Me.prototype,{name:{get:function(){return this._name}},show:{get:function(){return this._show},set:function(e){c.Z.defined("value",e),this._show=e;for(let t=0;t<this._layers.length;t++)(0,f.Z)(this._layers[t]._tileset)&&(this._layers[t]._tileset.show=this._show)}},traceFetches:{get:function(){return this._traceFetches},set:function(e){c.Z.defined("value",e),this._traceFetches=e}},geoidTiledTerrainProvider:{get:function(){return this._geoidTiledTerrainProvider}},layers:{get:function(){return this._layers}},data:{get:function(){return this._data}},extent:{get:function(){return this._extent}},resource:{get:function(){return this._resource}}}),Me.prototype.destroy=function(){for(let e=0;e<this._layers.length;e++)(0,f.Z)(this._layers[e]._tileset)&&this._layers[e]._tileset.destroy();return(0,O.Z)(this)},Me.prototype.isDestroyed=function(){return!1},Me.prototype.update=function(e){for(let t=0;t<this._layers.length;t++)(0,f.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.update(e)},Me.prototype.prePassesUpdate=function(e){for(let t=0;t<this._layers.length;t++)(0,f.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.prePassesUpdate(e)},Me.prototype.postPassesUpdate=function(e){for(let t=0;t<this._layers.length;t++)(0,f.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.postPassesUpdate(e)},Me.prototype.updateForPass=function(e,t){for(let i=0;i<this._layers.length;i++)(0,f.Z)(this._layers[i]._tileset)&&this._layers[i]._tileset.updateForPass(e,t)},Me.fromUrl=async function(e,t){c.Z.defined("url",e),t=(0,d.Z)(t,d.Z.EMPTY_OBJECT);const i=Z.Z.createIfNeeded(e),r=await Me.loadJson(i),n=new Me(t);if(n._resource=i,n._data=r,(0,f.Z)(r.layers))for(let s=0;s<r.layers.length;s++){const e=new Ue(n,r.layers[s],s);n._layers.push(e)}else{const e=new Ue(n,r,r.id);n._layers.push(e)}n._computeExtent();const a=[];for(let s=0;s<n._layers.length;s++)a.push(n._layers[s].load(t.cesium3dTilesetOptions));return await Promise.all(a),n},Me._fetchJson=function(e){return e.fetchJson()},Me.loadJson=async function(e,t){t&&console.log("I3S FETCH:",e.url);const i=await Me._fetchJson(e);if((0,f.Z)(i.error)){if(console.error("Failed to fetch I3S ",e.url),(0,f.Z)(i.error.message)&&console.error(i.error.message),(0,f.Z)(i.error.details))for(let e=0;e<i.error.details.length;e++)console.log(i.error.details[e]);throw new k.Z(i.error)}return i},Me.prototype._loadBinary=function(e){return this._traceFetches&&console.log("I3S FETCH:",e.url),e.fetchArrayBuffer()},Me.prototype._binarizeGltf=function(e){const t=new TextEncoder,i=t.encode(JSON.stringify(e)),r=new Uint8Array(i.byteLength+20),n={magic:new Uint8Array(r.buffer,0,4),version:new Uint32Array(r.buffer,4,1),length:new Uint32Array(r.buffer,8,1),chunkLength:new Uint32Array(r.buffer,12,1),chunkType:new Uint32Array(r.buffer,16,1),chunkData:new Uint8Array(r.buffer,20,i.byteLength)};return n.magic[0]="g".charCodeAt(),n.magic[1]="l".charCodeAt(),n.magic[2]="T".charCodeAt(),n.magic[3]="F".charCodeAt(),n.version[0]=2,n.length[0]=r.byteLength,n.chunkLength[0]=i.byteLength,n.chunkType[0]=1313821514,n.chunkData.set(i),r};const Ve=new u.Z;function Be(e,t){const i=e.tilingScheme,r=[],n={},a=e._lodCount,s=F.Z.fromRadians(t.west,t.north),o=F.Z.fromRadians(t.east,t.south),l=i.positionToTileXY(s,a),c=i.positionToTileXY(o,a);for(let d=l.x;d<=c.x;d++)for(let t=l.y;t<=c.y;t++){const s=u.Z.fromElements(d,t,Ve),o=s.toString();if(!n.hasOwnProperty(o)){const t={x:s.x,y:s.y,level:a,tilingScheme:i,terrainProvider:e,positions:[]};n[o]=t,r.push(t)}}const h=[];for(let u=0;u<r.length;++u){const e=r[u],t=e.terrainProvider.requestTileGeometry(e.x,e.y,e.level);h.push(t)}return Promise.all(h).then((function(e){const t=[];for(let n=0;n<e.length;n++){const a={tilingScheme:i,x:r[n].x,y:r[n].y,level:r[n].level},s=e[n];let o="Geographic";i._projection instanceof N.Z&&(o="WebMercator");const l={projectionType:o,projection:i._projection,nativeExtent:i.tileXYToNativeRectangle(a.x,a.y,a.level),height:s._height,width:s._width,scale:s._structure.heightScale,offset:s._structure.heightOffset};if(s._encoding===p.Z.LERC){const e=Se.decode(s._buffer);l.buffer=e.pixels[0]}else l.buffer=s._buffer;t.push(l)}return t}))}async function Ce(e){const t=e._geoidTiledTerrainProvider;if((0,f.Z)(t))try{const i=await Be(t,e._extent);e._geoidDataList=i}catch(i){console.log("Error retrieving Geoid Terrain tiles - no geoid conversion will be performed.")}else console.log("No Geoid Terrain service provided - no geoid conversion will be performed.")}Me.prototype.loadGeoidData=async function(){return(0,f.Z)(this._geoidDataPromise)||(this._geoidDataPromise=Ce(this)),this._geoidDataPromise},Me.prototype._computeExtent=function(){let e;for(let t=0;t<this._layers.length;t++)if((0,f.Z)(this._layers[t]._extent)){const i=this._layers[t]._extent;(0,f.Z)(e)?v.Z.union(e,i,e):e=v.Z.clone(i)}this._extent=e};var Ee=Me,Le=(i(13226),{mounted(){this.init()},methods:{async init(){const e=new s.Z("cesiumContainer",{terrainProvider:await o.Z(),animation:!1,timeline:!1});l.Z.supportsImageRenderingPixelated()&&(e.resolutionScale=window.devicePixelRatio),e.scene.postProcessStages.fxaa.enabled=!0,e.scene.debugShowFramesPerSecond=!0;const t=await R.fromUrl("https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/EGM2008/ImageServer"),i={traceFetches:!1,geoidTiledTerrainProvider:t},r=await Ee.fromUrl("https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/SanFrancisco_3DObjects_1_7/SceneServer/layers/0",i);e.scene.primitives.add(r);const n=v.Z.center(r.extent);n.height=1e4,e.camera.setView({destination:m.Z.WGS84.cartographicToCartesian(n)})}}}),Re=i(40089);const Fe=(0,Re.Z)(Le,[["render",a],["__scopeId","data-v-3bb9a916"]]);var Oe=Fe}}]);
//# sourceMappingURL=687.dc442ce9.js.map